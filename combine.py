import os
import json
import pandas as pd

def flatten_json(json_data, parent_key='', separator='_'):
    items = {}
    for key, value in json_data.items():
        new_key = f"{parent_key}{separator}{key}" if parent_key else key
        if isinstance(value, dict):
            items.update(flatten_json(value, new_key, separator))
        else:
            items[new_key] = value
    return items

def combine_json_to_excel(output_filename, num_reports):
    data_list = []
    for i in range(1, num_reports+1):
        filename = f"report({i}).json"
        if os.path.exists(filename):
            with open(filename, 'r') as file:
                try:
                    data = json.load(file)
                    flattened_data = flatten_json(data)
                    data_list.append(flattened_data)
                except json.JSONDecodeError as e:
                    print(f"Error decoding JSON in file {filename}: {e}")

    df = pd.DataFrame(data_list)
    df.to_excel(output_filename, index=False)

    print(f"Successfully combined {len(data_list)} JSON files into {output_filename}")

if __name__ == "__main__":
    num_reports = 113  # Change this to the desired number of reports (e.g., 5)
    output_file = 'combined.xlsx'  # Change this to the desired output Excel filename

    combine_json_to_excel(output_file, num_reports)
